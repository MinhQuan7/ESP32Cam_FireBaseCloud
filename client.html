<html>
  <head>
    <title>Client</title>
    <head>
      <h1>Video Streaming : ESP32Camera</h1>
    </head>
    <style>
      #datetime {
        position: absolute;
        top: 10px;
        left: 10px;
        color: white;
        background-color: rgba(0, 0, 0, 0.5);
        padding: 5px;
        font-family: Arial, sans-serif;
        font-size: 14px;
      }

      img {
        width: 100%;
        height: auto;
      }

      body {
        margin: 0;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div id="datetime"></div>
    <img src="" />
    <script>
      const img = document.querySelector("img");
      const datetime = document.getElementById("datetime");
      const WS_URL = "ws://192.168.1.16:8888";
      const ws = new WebSocket(WS_URL);
      let urlObject;

      ws.onopen = () => console.log(`Connected to ${WS_URL}`);

      ws.onmessage = (message) => {
        const arrayBuffer = message.data;
        if (urlObject) {
          URL.revokeObjectURL(urlObject);
        }
        urlObject = URL.createObjectURL(new Blob([arrayBuffer]));
        img.src = urlObject;
      };

      // Function to update the date and time every second
      function updateDateTime() {
        const now = new Date();
        const options = {
          timeZone: "Asia/Ho_Chi_Minh",
          weekday: "short",
          year: "numeric",
          month: "short",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        };
        const formattedDateTime = now.toLocaleString("en-US", options);
        datetime.textContent = formattedDateTime;
      }

      // Update the date and time every second
      setInterval(updateDateTime, 1000);
    </script>

    
    /*_____________________ERa configuration________________*/
    <script src="https://www.unpkg.com/@eohjsc/era-widget@1.1.3/src/index.js"></script>
    <script>
      let lastextractVideos = null;
      const eraWidget = new EraWidget();
      let config = { id: 51152 }; //Change id with each widget
      let extractVideoValue = null; 

      eraWidget.onConfiguration((configuration) => {
          console.log("Full configuration received:", configuration);
          console.log("Using configuration for extractVideoValue with ID:", config.id);
      });

      eraWidget.onValues((values) => {
        console.log("Received values:", values);
        if (values[config.id]) {
          extractVideoValue = values[config.id].value;
            console.log("Received extractVideoValue:", extractVideoValue);

            if (extractVideoValue === 0 && lastextractVideos !== 0) {
                console.log("Request extract videos. Loading...");

                //_________________________________________________________________
                //______________Supply videos from streaming Websocket_____________________
                

            }

            lastextractVideos = extractVideoValue;
        } else {
            console.log("No valid values received for extractVideoValue with ID:", config.id);
        }
    });
    eraWidget.ready();

    </script>
  </body>
</html>

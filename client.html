<html>
  <head>
    <title>Client</title>
    <head>
      <h1>Video Streaming : ESP32Camera</h1>
    </head>
    <style>
      #datetime {
        position: absolute;
        top: 10px;
        left: 10px;
        color: white;
        background-color: rgba(0, 0, 0, 0.5);
        padding: 5px;
        font-family: Arial, sans-serif;
        font-size: 14px;
        margin-top: 50px;
      }

      img {
        width: 100%;
        height: auto;
      }

      body {
        margin: 0;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div id="datetime"></div>
    <img src="" />
    <script>
      const img = document.querySelector("img");
      const datetime = document.getElementById("datetime");

      //_______________________Must change________________________
      const WS_URL = "ws://192.168.1.16:8888"; //must change
      const ws = new WebSocket(WS_URL);
      let urlObject;

      ws.onopen = () => console.log(`Connected to ${WS_URL}`);

      ws.onmessage = (message) => {
        const arrayBuffer = message.data;
        if (urlObject) {
          URL.revokeObjectURL(urlObject);
        }
        urlObject = URL.createObjectURL(new Blob([arrayBuffer]));
        img.src = urlObject;
      };
      // Function to update the date and time every second
      function updateDateTime() {
        const now = new Date();
        const options = {
          timeZone: "Asia/Ho_Chi_Minh",
          weekday: "short",
          year: "numeric",
          month: "short",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        };
        const formattedDateTime = now.toLocaleString("en-US", options);
        datetime.textContent = formattedDateTime;
      }

      // Update the date and time every second
      setInterval(updateDateTime, 1000);
    </script>

  
    <!-- <script src="https://www.unpkg.com/@eohjsc/era-widget@1.1.3/src/index.js"></script>
    <script>
      //____________________E-Ra Configurations__________________________
      let lastextractVideos = null;
      const eraWidget = new EraWidget();
      let config = { id: 55477 }; //Change id with each widget
      let extractVideoValue = null;

      eraWidget.onConfiguration((configuration) => {
        console.log("Full configuration received:", configuration);
        console.log(
          "Using configuration for extractVideoValue with ID:",
          config.id
        );
      });

      eraWidget.onValues((values) => {
        console.log("Received values:", values);
        if (values[config.id]) {
          extractVideoValue = values[config.id].value;
          console.log("Received extractVideoValue:", extractVideoValue);

          if (extractVideoValue === 0 && lastextractVideos !== 0) {
            console.log("Request extract videos. Loading...");

            // Gọi API từ client tới server để trích xuất video
            fetch("/extractVideo")
              .then(response => response.json()) //Xử lý phản hồi 
              .then(data => console.log(data.message)) //Xử lý dữ liệu phản hổi 
              .catch(error => console.error("Error extracting video:", error)); //Xử lý lỗi 
          }

          lastextractVideos = extractVideoValue;
        } else {
          console.log(
            "No valid values received for extractVideoValue with ID:",
            config.id
          );
        }
      });
      eraWidget.ready();
    </script> -->


    //_____________________Extract Videos : Listen request from Client____________
     
  </body>
</html>

</html>
